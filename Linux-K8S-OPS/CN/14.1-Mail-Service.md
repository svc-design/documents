

svc.plus è½»é‡å‘ä¿¡é‚®ä»¶ç³»ç»Ÿï¼ˆç²¾ç®€ç‰ˆï¼Œæ—  Certbotï¼‰
ğŸ§­ ä¸€ã€ç³»ç»Ÿç›®æ ‡
é¡¹ç›®	è¯´æ˜
åŸŸå	svc.plus
é‚®ä»¶ä¸»æœº	mail.svc.plus
å‘ä¿¡åè®®	SMTP Submission (587 STARTTLS) + SMTPS (465)
éªŒè¯æœºåˆ¶	SASL ç™»å½•ï¼ˆDovecotï¼‰
åŠ å¯†æœºåˆ¶	æ‰‹åŠ¨ TLS è¯ä¹¦ï¼ˆCloudflare / acme.sh / Nginx ç”Ÿæˆï¼‰
ç­¾åæœºåˆ¶	DKIMï¼ˆOpenDKIMï¼‰
ä¿¡ä»»é“¾	SPF / DKIM / DMARC / rDNS
ç¦ç”¨åŠŸèƒ½	å¤–éƒ¨æ”¶ä¿¡ï¼ˆå…³é—­ 25ï¼‰
è´¦æˆ·ç¤ºä¾‹	noreply@svc.plus, support@svc.plus
ğŸ§± äºŒã€ç»„ä»¶ç»“æ„
ç»„ä»¶	ä½œç”¨	çŠ¶æ€
Postfix	å‘ä¿¡æ ¸å¿ƒï¼Œæä¾› 587/465	âœ… å¯ç”¨
Dovecot	SASL ç™»å½•éªŒè¯	âœ… å¯ç”¨
OpenDKIM	é‚®ä»¶ç­¾å	âœ… å¯ç”¨
TLS è¯ä¹¦	/etc/ssl/mail.svc.plus/	âœ… æ‰‹åŠ¨ç®¡ç†
Certbot	è‡ªåŠ¨ç­¾å‘ TLS	âŒ ä¸å®‰è£…
âš™ï¸ ä¸‰ã€DNS é…ç½®ï¼ˆ6 æ¡ï¼‰
ç±»å‹	ä¸»æœºå	ç¤ºä¾‹å€¼	è¯´æ˜
A	mail.svc.plus	203.0.113.42	é‚®ä»¶ä¸»æœº
MX	svc.plus	mail.svc.plus	é‚®ä»¶å…¥å£
TXT (SPF)	svc.plus	"v=spf1 a mx ip4:203.0.113.42 ~all"	å‘ä¿¡æˆæƒ
TXT (DKIM)	default._domainkey.svc.plus	"v=DKIM1; k=rsa; p=MIIBIjANBg..."	DKIM å…¬é’¥
TXT (DMARC)	_dmarc.svc.plus	"v=DMARC1; p=quarantine; rua=mailto:dmarc@svc.plus"	ç­–ç•¥ä¸æŠ¥å‘Š
PTR	203.0.113.42	mail.svc.plus	åå‘è§£æ
ğŸ”Œ å››ã€ç«¯å£è§„åˆ’
ç«¯å£	åŠŸèƒ½	åŠ å¯†	æ˜¯å¦å¼€æ”¾å…¬ç½‘
587	SMTP Submission	STARTTLS	âœ…
465	SMTPSï¼ˆéšå¼ TLSï¼‰	Implicit TLS	âœ…
25	SMTP Relay	STARTTLS	âŒ ç¦ç”¨
ğŸ§© äº”ã€è¯ä¹¦è·¯å¾„ä¸ç¤ºä¾‹

æ”¾ç½®è·¯å¾„ï¼š

/etc/ssl/mail.svc.plus/fullchain.pem
/etc/ssl/mail.svc.plus/privkey.pem


æƒé™è®¾ç½®ï¼š

sudo chown root:postfix /etc/ssl/mail.svc.plus/*
sudo chmod 640 /etc/ssl/mail.svc.plus/privkey.pem


æ›´æ–°è¯ä¹¦æ—¶åªéœ€è¦†ç›–è¿™ä¸¤ä¸ªæ–‡ä»¶å¹¶é‡å¯ Postfixï¼š

sudo systemctl restart postfix

ğŸ¤ å…­ã€Postfix ä¸»é…ç½®ï¼ˆ/etc/postfix/main.cfï¼‰
myhostname = mail.svc.plus
mydomain = svc.plus
inet_interfaces = all
inet_protocols = ipv4
mydestination =
relayhost =
mynetworks = 127.0.0.0/8

# TLS
smtpd_tls_cert_file=/etc/ssl/mail.svc.plus/fullchain.pem
smtpd_tls_key_file=/etc/ssl/mail.svc.plus/privkey.pem
smtpd_use_tls=yes
smtpd_tls_security_level=may
smtp_tls_security_level=may
smtpd_tls_auth_only=yes

# SASL via Dovecot
smtpd_sasl_type = dovecot
smtpd_sasl_path = private/auth
smtpd_sasl_auth_enable = yes

# ä»…å…è®¸è®¤è¯ç”¨æˆ·å‘ä¿¡
smtpd_recipient_restrictions =
    permit_sasl_authenticated,
    reject_unauth_destination

ğŸ§° ä¸ƒã€Postfix ç«¯å£å®šä¹‰ï¼ˆ/etc/postfix/master.cfï¼‰
# 587 STARTTLS
submission inet n - y - - smtpd
  -o syslog_name=postfix/submission
  -o smtpd_tls_security_level=encrypt
  -o smtpd_sasl_auth_enable=yes
  -o smtpd_recipient_restrictions=permit_sasl_authenticated,reject

# 465 SMTPS
smtps inet n - y - - smtpd
  -o syslog_name=postfix/smtps
  -o smtpd_tls_wrappermode=yes
  -o smtpd_sasl_auth_enable=yes
  -o smtpd_recipient_restrictions=permit_sasl_authenticated,reject

ğŸ”‘ å…«ã€Dovecotï¼ˆSASL ç™»å½•ï¼‰

è®¤è¯ Socketï¼š
/etc/dovecot/conf.d/10-master.conf

service auth {
  unix_listener /var/spool/postfix/private/auth {
    mode = 0660
    user = postfix
    group = postfix
  }
}


ç”¨æˆ·æ•°æ®åº“ï¼š
/etc/dovecot/users

noreply@svc.plus:{SHA512-CRYPT}$6$VEXD...hash...
support@svc.plus:{SHA512-CRYPT}$6$VEXD...hash...


ç”Ÿæˆå¯†ç ï¼š

doveadm pw -s SHA512-CRYPT


è®¤è¯æœºåˆ¶ï¼š
/etc/dovecot/conf.d/10-auth.conf

disable_plaintext_auth = yes
auth_mechanisms = plain login
passdb {
  driver = passwd-file
  args = scheme=SHA512-CRYPT username_format=%u /etc/dovecot/users
}
userdb {
  driver = static
  args = uid=vmail gid=vmail home=/var/mail/%d/%n
}

âœï¸ ä¹ã€DKIMï¼ˆOpenDKIMï¼‰

ç”Ÿæˆå¯†é’¥ï¼š

sudo mkdir -p /etc/opendkim/keys/svc.plus
cd /etc/opendkim/keys/svc.plus
sudo opendkim-genkey -s default -d svc.plus
sudo chown opendkim:opendkim default.*


é…ç½®ï¼š
/etc/opendkim.conf

Syslog                  yes
UMask                   002
Socket                  inet:8891@localhost
Canonicalization        relaxed/simple
Mode                    sv
Domain                  svc.plus
KeyFile                 /etc/opendkim/keys/svc.plus/default.private
Selector                default
UserID                  opendkim:opendkim


åœ¨ /etc/postfix/main.cf æœ«å°¾åŠ ï¼š

smtpd_milters = inet:localhost:8891
non_smtpd_milters = $smtpd_milters
milter_default_action = accept
milter_protocol = 2

ğŸš€ åã€å¯åŠ¨ä¸æµ‹è¯•
sudo systemctl restart postfix dovecot opendkim
sudo systemctl enable postfix dovecot opendkim


æµ‹è¯•å‘ä¿¡ï¼š

swaks --server mail.svc.plus --port 587 --tls \
  --auth LOGIN --auth-user noreply@svc.plus \
  --auth-password 'yourpass' \
  --from noreply@svc.plus --to you@gmail.com


Gmail â†’ æŸ¥çœ‹åŸå§‹é‚®ä»¶ï¼š

SPF: PASS
DKIM: PASS
DMARC: PASS

ğŸ”’ åä¸€ã€å®‰å…¨ä¸ç»´æŠ¤
ä»»åŠ¡	å‘¨æœŸ	è¯´æ˜
TLS è¯ä¹¦æ›´æ–°	æŒ‰éœ€	æ‰‹åŠ¨è¦†ç›–è¯ä¹¦æ–‡ä»¶
DKIM å¯†é’¥è½®æ¢	æ¯ 6-12 ä¸ªæœˆ	é‡æ–°ç”Ÿæˆ
ç”¨æˆ·ç®¡ç†	æŒ‰éœ€	ç¼–è¾‘ /etc/dovecot/users
æ—¥å¿—æ£€æŸ¥	å®šæœŸ	/var/log/mail.log
ä¿¡ä»»éªŒè¯	å®šæœŸ	mail-tester.com

é˜²ç«å¢™ï¼š

ufw allow 587/tcp
ufw allow 465/tcp
ufw enable

ğŸ§  åäºŒã€æ€»ç»“æ¸…å•
é¡¹ç›®	æ•°é‡	è¯´æ˜
DNS è®°å½•	6 æ¡	A / MX / SPF / DKIM / DMARC / PTR
æ ¸å¿ƒæœåŠ¡	3 ä¸ª	Postfix + Dovecot + OpenDKIM
å…¬ç½‘ç«¯å£	2 ä¸ª	587ï¼ˆSTARTTLSï¼‰+ 465ï¼ˆSMTPSï¼‰
TLS è¯ä¹¦	æ‰‹åŠ¨	/etc/ssl/mail.svc.plus/
è®¤è¯æ–¹å¼	SASL ç™»å½•ï¼ˆDovecotï¼‰
ç­¾åæœºåˆ¶	DKIM
é€è¾¾ä¿¡ä»»é“¾	SPF + DKIM + DMARC + rDNS

ğŸ§© æœ€å°ã€å¯æ§ã€ç¨³å®šï¼š
ä¸€æœºå®Œæˆå‘ä¿¡ â†’ åŠ å¯† â†’ ç­¾å â†’ éªŒè¯ï¼Œ
æŠ¤å‘¨æœŸä½ã€é€è¾¾ç‡é«˜ã€å…¼å®¹æ‰€æœ‰ä¸»æµé‚®ä»¶æœåŠ¡ã€‚
