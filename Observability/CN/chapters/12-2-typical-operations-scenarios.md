# Typical Operations Scenarios

Illustrates common operational situations that highlight the need for effective monitoring across systems and services.

## 1) 发布与环境

-  **灰度发布（Canary/Blue-Green）**
 触发：新版本可用 → 动作：按权重放量/自动回滚 → 校验：`service_call_5m` 的 p95/err\_rate 门槛。
 
-  **特性开关（Feature Flag）渐进开启**
 触发：验收通过 → 动作：按租户/地域打开 → 校验：关键路径转化率、错误率对比。
 
-  **依赖版本对齐（SDK/Sidecar/Agent）**
 触发：安全公告/CVE → 动作：批量滚更 → 校验：服务健康探针、崩溃率。
 
-  **配置漂移检测 & 回收**
 触发：Git 与运行态差异 → 动作：生成 PR/自动修复 → 校验：IaC 合规策略通过。
 

## 2) 可靠性与故障处置

-  **自动限流/熔断/隔离**
 触发：err\_rate↑ / p95↑ → 动作：在网关/服务级应用限流与熔断 → 校验：下游恢复、全链 p95 回落。
 
-  **异常回滚 & 一键 Mitigation**
 触发：SLO 未命中 → 动作：Plan DSL 的 `compensate` 执行 → 校验：回滚后 SLO 达标。
 
-  **降级策略编排（缓存兜底/只读模式）**
 触发：依赖服务不可用 → 动作：启用降级开关 → 校验：功能可用性≥阈值。
 
-  **日志噪声抑制 & 指纹提纯**
 触发：`log_pattern_5m` 激增 → 动作：更新过滤/聚合规则 → 校验：噪声占比下降。
 

## 3) 性能与容量优化

-  **自动扩缩容（HPA/VPA/KEDA）**
 触发：RPS/CPU/GPU 利用率门槛 → 动作：扩容/缩容 → 校验：p95/队列长度回稳。
 
-  **热点定位（Top-K 端点/表/索引）**
 触发：看板阈值 → 动作：生成优化建议（索引/缓存/批量） → 校验：目标指标改善幅度。
 
-  **慢查询守护（PostgreSQL/OLAP）**
 触发：计划回退/代价飙升 → 动作：计划冻结、索引重建、ANALYZE → 校验：执行时间降低。
 
-  **CDN/缓存命中率调优**
 触发：MISS 高/回源高 → 动作：规则更新、预热 → 校验：命中率↑、回源↓。
 

## 4) 数据与存储运维

-  **分区/压缩/保留策略执行（Timescale/OO）**
 触发：窗口到期 → 动作：Timescale 压缩、OO 生命周期转冷 → 校验：存储曲线与查询命中率。
 
-  **备份与恢复演练（DB/对象存）**
 触发：季度演练 → 动作：还原到沙箱/校验一致性 → 校验：RTO/RPO 达标。
 
-  **Schema 变更护栏（DDL 门控）**
 触发：DDL PR → 动作：影子评估/回放 → 校验：读写延迟无回退。
 
-  **数据质量监控（ETL/流式）**
 触发：空值/重复/延迟异常 → 动作：回填/重跑 → 校验：质量指标恢复。
 

## 5) 安全与合规

-  **证书与密钥轮换（TLS/KMS/ACME）**
 触发：到期前 N 天 → 动作：自动签发/分发/热加载 → 校验：握手成功率、无中断。
 
-  **CVE 修补与内核/容器镜像升级**
 触发：高危 CVE → 动作：分批滚更 → 校验：漏洞基线清零。
 
-  **访问评审与最小权限（RBAC/IAM）**
 触发：月度审计 → 动作：收敛权限/吊销闲置 → 校验：策略命中/拒绝率无异常。
 
-  **合规窗口/变更冻结**
 触发：活动/大促/监管窗口 → 动作：Gatekeeper 拒绝非白名单变更 → 校验：变更违规为 0。
 

## 6) 网络与边缘

-  **入口网关/Ingress 规则变更与回滚**
 触发：路径/权重调整 → 动作：灰度发布 Nginx/Envoy → 校验：5xx/延迟曲线。
 
-  **跨区流量调度/健康探测**
 触发：区域异常 → 动作：权重切换/只读路由 → 校验：丢包/RTT 恢复。
 
-  **证书/ECH/TLS 指纹更新（Xray/Sing-box）**
 触发：策略更新 → 动作：节点批量更新 → 校验：连通率、误封率。
 
-  **Egress/WAF 策略**
 触发：异常出站/攻击面提示 → 动作：规则下发 → 校验：拦截率与误报率。
 

## 7) 集群与平台生命周期（K8s/容器/GPU）

-  **K8s 小版本升级 & 节点滚更**
 触发：版本落后 → 动作：逐组 Cordon/Drain/升级 → 校验：工作负载无中断。
 
-  **GPU 驱动/Operator 更新（A10/L40/A100）**
 触发：新特性/修复 → 动作：分池灰度 → 校验：`nvidia-smi`/MIG 配置正确、作业吞吐。
 
-  **容器运行时/镜像仓库镜像切换**
 触发：镜像拉取慢/失效 → 动作：镜像加速/离线包 → 校验：拉取成功率、构建时长。
 
-  **Ingress 离线安装包验证（你已有目标）**
 触发：新离线包 → 动作：沙箱校验/多架构镜像加载 → 校验：可用性与兼容性。
 

## 8) AI/ML 与数据应用运维

-  **模型上线策略（Shadow→Canary）**
 触发：新模型评估通过 → 动作：影子对比/小流量灰度 → 校验：质量指标、成本/QPS。
 
-  **数据/概念漂移监测**
 触发：分布/性能漂移 → 动作：告警/Retrain 计划 → 校验：OOS 指标回升。
 
-  **RAG 质量守护（向量库更新/召回评测）**
 触发：知识变更 → 动作：重嵌入/基准集评测 → 校验：Top-k 命中率/答案自信度。
 
-  **推理路由与预算控制（多端点）**
 触发：延迟/价格波动 → 动作：路由切换/配额限流 → 校验：SLO 与成本曲线。
 

## 9) 可观测性与告警工程

-  **SLO 定义与回归检测**
 触发：SLO 变更 → 动作：历史重放评估 → 校验：误报/漏报下降。
 
-  **告警噪声治理**
 触发：高噪声规则 → 动作：聚合/抑制窗口优化 → 校验：On-call 负担降低。
 
-  **追踪抽样自适应**
 触发：流量/成本压力 → 动作：按错误/慢请求倾斜采样 → 校验：诊断覆盖率保持。
 

## 10) 灾备与演练

-  **多区域演练（GameDay/Chaos）**
 触发：季度/半年度 → 动作：注入故障/演练切流 → 校验：RTO/RPO/SLO 达标。
 
-  **对象存储/消息系统灾备切换**
 触发：主域不可用 → 动作：桶/Topic/镜像切换 → 校验：数据一致性与延迟。
 

## 11) FinOps（成本与资源）

-  **实例规格与副本数 Rightsizing**
 触发：长期低/高利用 → 动作：规格/副本调整 → 校验：性能不降、成本下降。
 
-  **Spot/预留/竞价策略编排**
 触发：价格/回收风险 → 动作：池化/回填 → 校验：业务无损、成本可控。
 
-  **存储分层（热/温/冷）与清理**
 触发：访问频次变化 → 动作：生命周期迁移/清理 → 校验：成本下降、命中率合理。
 

## 12) 自助与治理

-  **服务目录 + 变更申请自助**
 触发：团队提变更 → 动作：模板化 Plan、Gatekeeper 审批 → 校验：周期缩短、违规为 0。
 
-  **合规审计与证据归档**
 触发：审计周期 → 动作：导出 `event_envelope + evidence_link` → 校验：稽核一次通过。