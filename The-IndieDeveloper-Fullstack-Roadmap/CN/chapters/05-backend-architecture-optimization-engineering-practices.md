# 第5月：后端架构优化与工程化实践

- 第17周：微服务设计与 API 网关
- 第18周：缓存与性能优化（Redis/查询优化）
- 第19周：持续集成与部署（CI/CD）
- 第20周：安全测试与加固

## 技能目标

提升项目的后端架构与工程质量，引入专业工程实践。掌握微服务架构基础、性能调优、安全加固等知识点，将项目提升到可维护、高可靠的工程水平。

## 核心理论内容

- **微服务架构设计**：理解微服务的思想和优缺点，将单体应用按业务边界拆分的原则（例如将用户管理、影片内容、评论等服务拆分）。学习服务间通信基础（HTTP/RPC、消息队列概念），以及 API 网关的作用。
- **配置与环境管理**：掌握多环境配置管理方法（开发/测试/生产配置分离），敏感信息管理（如使用环境变量或配置文件，不将秘钥硬编码），确保应用在不同部署环境下可灵活配置。
- **持续集成/持续部署 (CI/CD)**：学习 CI/CD 流水线的原理和流程（代码构建、自动测试、镜像构建与部署）。了解常用 CI 工具（GitHub Actions、Jenkins 等）的使用，确保代码变更可以自动化测试和部署，提高发布效率与可靠性。
- **测试策略**：深入软件测试金字塔概念：单元测试、集成测试、端到端测试的区别和侧重点。学习编写集成测试（模拟多个模块或服务交互）和性能测试（负载测试工具如 JMeter、k6 的基本使用），保障系统质量和性能。
- **安全与加固**：系统性讲解 Web 安全策略：防御常见攻击如 CSRF（了解并应用跨站请求伪造防护机制，如 SameSite Cookie、防伪令牌）、XSS（输出编码及内容安全策略 CSP）、SQL 注入（使用参数化查询/ORM 防范）。审视当前项目中可能存在的安全漏洞并探讨改进措施。
- **性能优化**：掌握后端性能优化方法：数据库索引优化、查询性能分析（解释执行计划）、利用缓存减轻数据库压力（如引入 Redis 做热点数据缓存）、后端异步任务处理（使用消息队列或后台任务执行长耗时操作）等。学会使用性能分析工具和监控指标（CPU、内存、响应时间）来定位瓶颈。

## 实践项目

- **服务拆分与集成**：尝试将项目部分功能提取为独立服务。例如，将评论系统拆分为单独的微服务（可选用另一种语言实现以作对比练习，如主服务用 Rust，则评论服务用 Go），实现基础的服务间通信（通过 REST API 调用或消息队列模拟）。调整原有架构，使前端通过 API 网关或聚合接口访问各服务的数据。
- **引入缓存**：在后端加入缓存层：安装并配置 Redis，在热点接口（如影片列表/热门影片）中增加缓存逻辑。实践缓存失效策略，确保数据一致性的同时显著提高响应速度。
- **配置管理**：将项目的配置（数据库连接串、第三方 API 密钥等）抽取到配置文件或环境变量中。实践在本地、测试环境、生产环境使用不同配置的方法，编写配置读写模块，确保应用对配置变化敏感。
- **CI/CD Pipeline**：为项目设置持续集成流水线：编写配置文件（如 GitHub Actions YAML）使代码在每次推送时自动运行测试套件；配置 Docker 打包后端服务镜像，并使用 Docker Compose 编排多个服务运行。在持续部署方面，可模拟部署到云服务器或容器服务平台的流程，实现一键部署更新。
- **测试与质量保障**：扩充测试覆盖率：编写集成测试场景，例如模拟用户完整流程（登录 -> 查看影片 -> 发表评论），验证各模块协作是否正常。使用压力测试工具对主要接口进行压测，分析系统在高并发下的性能，记录 QPS、响应时间等指标并进行优化。
- **安全检查**：对现有应用进行安全审计：使用自动化工具（如静态代码扫描、依赖漏洞扫描）检查安全隐患。手动测试常见漏洞，如尝试在输入框输入脚本标签测试 XSS，在 API 请求中篡改参数测试权限校验是否严格。针对发现的问题，修复代码或增加安全配置。例如，引入 CSRF 防护中间件、严格内容安全策略头设置等，并再次测试验证防护效果。
- **工具链**：Docker 容器及 Docker Compose，Redis 缓存数据库，消息队列（可选，如 RabbitMQ/Kafka 模拟练习或用本地内存队列模拟），GitHub Actions/Jenkins 等 CI 工具，测试工具（JUnit/Go testing 库用于集成测试，k6/JMeter 用于压力测试），安全扫描工具（Dependabot、SonarQube 等）。

## 软技能练习

- **DevOps 思维**：通过设置 CI/CD 和容器化部署，学员切实体会开发运维一体化流程。练习撰写部署说明和运维文档，就如向运维团队移交项目一样，培养对部署上线环节的重视和责任心。
- **团队角色转换**：本阶段鼓励学员轮流扮演不同团队角色。例如今天作为“DevOps 工程师”检查 CI 配置，明天作为“DBA”优化数据库索引，后天是“安全工程师”审计代码。通过角色转换体会各岗位关注点，提升与不同团队协作沟通的能力。
- **任务协调**：面对第五月繁多的优化任务，学员需练习优先级管理：使用任务管理工具对各项工作排优先顺序（安全高于新功能，修 bug 优于微优化等），模拟真实项目中多任务并行推进的情形，锻炼统筹协调能力。
- **远程协作**：如果可能，将项目部署到云端测试环境，组织一次线上演示或测试活动。学员需通过远程会议向他人演示项目功能、讲解架构设计，并收集改进建议。通过这种模拟远程工作的方式，提升异地协作和线上表达能力。
- **总结与分享**：月末对工程化改进进行总结，整理一份“架构优化报告”，阐述系统当前架构、优化措施及效果数据。将报告分享至技术社区或博客平台，练习向公众清晰表述技术方案的能力，为个人技术影响力打基础。

## 学习计划

| 月份 | 周次 | 技能目标 | 核心内容 | 实践任务 | 软技能 |
| --- | --- | --- | --- | --- | --- |
| 第5月 工程化 | 第17周 | 微服务设计 | API Gateway，服务拆分 | 拆分评论服务（Go/Rust） | 扮演不同团队角色（Dev/DBA） |
| 第5月 工程化 | 第18周 | 缓存优化 | Redis 引入 | 热点电影列表缓存 | 练习任务优先级管理 |
| 第5月 工程化 | 第19周 | CI/CD | GitHub Actions / Gitlab CI 自动化测试 + Docker 镜像 | 配置流水线并构建镜像 | 编写部署说明文档 |
| 第5月 工程化 | 第20周 | 安全测试 | CSRF/XSS/SQL 注入 | 安全扫描并修复漏洞 | 安全审计演练 |
